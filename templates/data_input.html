<body>
<div>
  <link rel="stylesheet" href="//unpkg.com/element-ui@2.15.14/lib/theme-chalk/index.css">
  <link rel="stylesheet" href="../static/css/data_input.css"/>
  <link rel="preload" href="https://coscdn.htmlpage.cn/sandbox/assets/fonts/Unicons.woff2" as="font"
        type="font/woff2"/>
  <link rel="stylesheet" href="https://coscdn.htmlpage.cn/sandbox/assets/css/plugins.css"/>
  <link rel="stylesheet" href="https://coscdn.htmlpage.cn/sandbox/assets/css/style.css"/>
  <link rel="stylesheet" href="https://coscdn.htmlpage.cn/sandbox/assets/css/colors/orange.css"/>
  <link rel="preload" href="https://coscdn.htmlpage.cn/sandbox/assets/css/fonts/thicccboi.css" as="style"/>
  <div class="content-wrapper">
    <header class="wrapper bg-light">
      <!-- /.navbar -->
    </header>
    <!-- /header -->
    <section class="wrapper bg-light">
      <link rel="stylesheet" href="https://coscdn.htmlpage.cn/vip-tpl/assets/css/plugins.css"/>
      <link rel="stylesheet" href="https://coscdn.htmlpage.cn/vip-tpl/assets/css/style.css"/>
      <header data-image-src="https://coscdn.htmlpage.cn/sandbox/assets/img/photos/bg3.jpg" id="i5a7mm"
              class="wrapper image-wrapper bg-image pb-1 c95136">
        <nav class="navbar navbar-expand-lg classic transparent">
          <div class="container flex-lg-row flex-nowrap align-items-center">
            <img src="https://coscdn.htmlpage.cn/user-upload-images/7574/logo_whitte.png"
                 class="c109479"/>
            <div class="navbar-collapse offcanvas offcanvas-nav offcanvas-start">
              <div class="offcanvas-header d-lg-none">
                <a href="./index.html"><img
                  src="https://coscdn.htmlpage.cn/logos/logo-small-white.svg"
                  srcset="https://coscdn.htmlpage.cn/logos/logo-small-white.svg" alt=""/></a>
                <button type="button" data-bs-dismiss="offcanvas" aria-label="Close"
                        class="btn-close btn-close-white">Send
                </button>
              </div>
              <div class="offcanvas-body ms-lg-auto d-flex flex-column h-100 navbar-dark">
                <ul class="navbar-nav">
                  <li class="nav-item">
                    <a href="/" class="nav-link text-white">首页</a>
                  </li>
                  <li class="nav-item dropdown">
                  </li>
                  <li class="nav-item dropdown dropdown-mega">
                    <!--/.dropdown-menu -->
                  </li>
                  <a href="/data_input" class="nav-link text-white">数据填写</a>
                  <a href="#" class="nav-link text-white">往期数据</a>
                  <li class="nav-item dropdown">
                  </li>
                </ul>
                <!-- /.navbar-nav -->
                <div class="d-lg-none mt-auto pt-6 pb-6 order-4">
                  <a href="mailto:first.last@email.com" class="link-inverse">help@lapus.cn</a>
                  <br/> 00 (123) 456 78 90
                  <br/>
                  <nav class="nav social social-white mt-4">
                    <a href="#"><i class="uil uil-twitter">
                    </i></a>
                    <a href="#"><i class="uil uil-facebook-f">
                    </i></a>
                    <a href="#"><i class="uil uil-dribbble">
                    </i></a>
                    <a href="#"><i class="uil uil-instagram">
                    </i></a>
                    <a href="#"><i class="uil uil-youtube">
                    </i></a>
                  </nav>
                  <!-- /.social -->
                </div>
                <!-- /offcanvas-nav-other -->
              </div>
              <!-- /.offcanvas-body -->
            </div>
            <!-- /.navbar-collapse -->
            <div class="navbar-other ms-lg-4">
              <ul class="navbar-nav flex-row align-items-center ms-auto">
                <li class="nav-item">
                  <a data-bs-toggle="offcanvas" data-bs-target="#offcanvas-info"
                     class="nav-link text-white"></a>
                </li>
                <li class="nav-item d-none d-md-block">
                </li>
                <li class="nav-item d-lg-none">
                  <button type="button" class="hamburger offcanvas-nav-btn">Send</button>
                </li>
              </ul>
              <!-- /.navbar-nav -->
            </div>
            <!-- /.navbar-other -->
          </div>
          <!-- /.container -->
        </nav>
        <!-- /.navbar -->
      </header>
      <!--/.card-footer -->
      <script src="https://coscdn.htmlpage.cn/vip-tpl/assets/js/plugins.js"></script>
      <script src="https://coscdn.htmlpage.cn/vip-tpl/assets/js/theme.js"></script>
      <link rel="stylesheet" href="https://coscdn.htmlpage.cn/vip-tpl/assets/css/plugins.css"/>
      <link rel="stylesheet" href="https://coscdn.htmlpage.cn/vip-tpl/assets/css/style.css"/>
      <div class="container pt-11 pt-md-13 pb-11 pb-md-19 pb-lg-22 text-center">
        <div class="row">
          <div data-cues="slideInDown" data-group="page-title"
               class="col-lg-8 col-xl-7 col-xxl-6 mx-auto">
            <h1 class="display-1 fs-60 mb-4 px-md-15 px-lg-0">
              <span class="underline-3 style-3 primary">数据填写</span>
            </h1>
            <p class="lead fs-24 lh-sm mb-7 mx-md-13 mx-lg-10">
            </p>
            <h3 id="ijhh1" draggable="false" class="mb-10 px-xl-10 c14052">请在下面填写您将要申报的的企业数据
            </h3>
            <p>
              <script src="//unpkg.com/element-ui@2.15.14/lib/index.js"></script>
              <div id="app">
                <el-row>
                  <el-col :span="11">
                    <el-form>
                      <el-form-item label="请选择查看时间">
                        <el-date-picker
                          v-model="select_month"
                          type="month"
                          placeholder="请选择月份"
                          @change="handleClick"
                          value-format="yyyy-MM"
                          default-value="default_month"
                          :clearable="false"
                        ></el-date-picker>
                      </el-form-item>
                    </el-form>
                  </el-col>
                </el-row>
                <el-row>
                  <el-col :span="6">
                    <el-menu @select="handleSelect" default-active="工业产销总值及主要产品产量">
                      <el-submenu v-for="(cur_value, cur_key, cur_index) in myFormData" :index="cur_key">
                        <span slot="title" style="font-weight: bold;color: black;font-size: 24px">{{ "{{ cur_key }}" }}</span>
                        <el-menu-item-group>
                          <div v-for="(value, key, index) in cur_value">
                            <el-menu-item :index="key">{{ "{{ key }}" }}</el-menu-item>
                          </div>
                        </el-menu-item-group>
                      </el-submenu>
                    </el-menu>
                  </el-col>
                  <el-col :span="18">
                    <div style="display: flex; flex-wrap: wrap; justify-content: left">
                      <el-form :model="myFormData" ref="myFormData" label-width="250px" class="demo-dynamic">
                        <el-col :span="12" v-for="(item, index) in myFormData[globalKeyPath[0]][globalKeyPath[1]]">
                          <el-form-item
                            :label="item.key"
                            :key="item.key"
                            :prop="'item.' + item.key + '.index'"
                          >
                            <el-input v-model="item.value" @input="handleChange(item)" :disabled="can_change"></el-input>
                          </el-form-item>
                        </el-col>
                      </el-form>
                      <div style="margin-top: 20px; margin-left: 60px">
                        <a class="btn btn-sm btn-primary rounded-pill" @click="onHref()">申报预览</a>
                        <a class="btn btn-sm btn-primary rounded-pill" @click="onTransfer()">查看报表</a>
                        <a class="btn btn-sm btn-primary rounded-pill" @click="onSubmit()">保存数据</a>
                        <a class="btn btn-sm btn-primary rounded-pill" @click="onHref()">开始申报</a>
                      </div>
                    </div>
                  </el-col>
                </el-row>
                <el-row>
                </el-row>
              </div>
            </p>
          </div>
          <!-- /column -->
        </div>
        <!-- /section -->
        <script src="https://coscdn.htmlpage.cn/vip-tpl/assets/js/plugins.js"></script>
        <script src="https://coscdn.htmlpage.cn/vip-tpl/assets/js/theme.js"></script>
        <!-- /.row -->
      </div>
      <!-- /.container -->
    </section>
    <!-- /section -->
  </div>
  <!-- /.content-wrapper -->
  <footer class="bg-navy text-inverse">
    <div class="container pt-15 pt-md-17 pb-13 pb-md-15">
      <!--/div -->
      <div id="ivfuc8" class="c8285">
        <b>诚挚的感谢您对本产品的信任和使用！
        </b>
      </div>
      <hr class="mt-11 mb-12"/>
      <!--/.row -->
    </div>
    <!-- /.container -->
  </footer>
  <script src="https://coscdn.htmlpage.cn/sandbox/assets/js/plugins.js"></script>
  <script src="https://coscdn.htmlpage.cn/sandbox/assets/js/theme.js"></script>
  <!-- import Vue before Element -->
  <script src="https://unpkg.com/vue@2/dist/vue.js"></script>
  <!-- import JavaScript -->
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>
    new Vue({
      el: '#app',
      data() {
        return {
          myFormData: {},
          loading: true,
          activeNames: [],
          globalKeyPath: ['国家统计局', '工业产销总值及主要产品产量'],
          select_month: this.getCurrentTimeYYYYMM(),
          can_change: false
        }
      },
      methods: {
        handleChange(test) {
          let data = JSON.parse(JSON.stringify(this.myFormData));
          for (let item in data) {
            let temp = data[item];
            for (let inner in temp) {
              for (let i = 0; i < temp[inner].length; ++i) {
                if (temp[inner][i].id === test.id) {
                  data[item][inner][i].value = test.value;
                }
              }
            }
          }
          this.myFormData = data;
        },
        onHref() {
          axios.post('/save', {'date': this.select_month, 'data': this.myFormData}).then(res => {
            if (res.data.status === "ok") {
              window.location.href = '/start_fill'
            }
          })
        },
        onSubmit() {
          axios.post('/save', {'date': this.select_month, 'data': this.myFormData}).then(res => {
            if (res.data.status === "ok") {
              this.$message({
                message: '保存成功',
                type: 'success'
              });
            }
          })
        },
        onTransfer() {
            window.location.href = '/quarter_data'
        },
        handleSelect(key, keyPath) {
          this.globalKeyPath = keyPath;
        },
        handleClick() {
          this.can_change = this.getCurrentTimeYYYYMM() !== this.select_month;
          this.reqNewData();
        },
        getCurrentTimeYYYYMM() {
          const now = new Date();
          const year = now.getFullYear();
          const month = (now.getMonth() + 1).toString().padStart(2, '0'); // 月份是从0开始的
          return `${year}-${month}`;
        },
        reqNewData() {
          axios
            .get('/load_data?date=' + this.select_month)
            .then(response => {
              this.myFormData = response.data
              this.loading = false
            })
            .catch(error => {
              console.log(error)
              this.errored = true
            })
            .finally(() => this.loading = false)
        }
      },
      mounted() {
        this.reqNewData();
      }
    })
  </script>
</div>
</body>